<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete ERP Inventory Database Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: bold; }
        .success { background-color: #d4edda; color: #155724; border: 2px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 2px solid #f5c6cb; }
        .loading { background-color: #d1ecf1; color: #0c5460; border: 2px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 2px solid #ffeaa7; }
        .section { margin: 25px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .section h3 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .count { font-size: 1.2em; font-weight: bold; color: #007bff; }
        .api-test { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .api-test.success { background: #d4edda; }
        .api-test.error { background: #f8d7da; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="app" class="container">
        <h1>üîß Complete ERP Inventory Database Connection Test</h1>
        
        <div v-if="loading" class="status loading">
            <strong>‚è≥ Loading...</strong> Testing database connection and data retrieval...
        </div>
        
        <div v-if="error" class="status error">
            <strong>‚ùå Error:</strong> {{ error }}
        </div>
        
        <div v-if="!loading && !error && testResults.length > 0" class="status success">
            <strong>‚úÖ Database Connection Test Complete!</strong> All tests passed successfully.
        </div>

        <!-- API Endpoint Tests -->
        <div class="section">
            <h3>üîå API Endpoint Tests</h3>
            <div v-for="test in apiTests" :key="test.name" :class="['api-test', test.status]">
                <strong>{{ test.name }}:</strong> 
                <span v-if="test.status === 'success'">‚úÖ {{ test.message }}</span>
                <span v-else-if="test.status === 'error'">‚ùå {{ test.message }}</span>
                <span v-else>‚è≥ {{ test.message }}</span>
            </div>
        </div>

        <!-- Data Summary -->
        <div class="section" v-if="!loading">
            <h3>üìä Data Summary</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="api-test success">
                    <strong>Customers:</strong> <span class="count">{{ customers.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Suppliers:</strong> <span class="count">{{ suppliers.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Products:</strong> <span class="count">{{ products.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Incoming Orders:</strong> <span class="count">{{ ordersIn.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Outgoing Orders:</strong> <span class="count">{{ ordersOut.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Sites:</strong> <span class="count">{{ sites.length }}</span> records
                </div>
                <div class="api-test success">
                    <strong>Statuses:</strong> <span class="count">{{ statuses.length }}</span> records
                </div>
            </div>
        </div>

        <!-- Sample Data Display -->
        <div class="section" v-if="customers.length > 0">
            <h3>üë• Sample Customers</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Identifier</th>
                        <th>Active</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="customer in customers.slice(0, 3)" :key="customer.id">
                        <td>{{ customer.id }}</td>
                        <td>{{ customer.name }}</td>
                        <td>{{ customer.identifier }}</td>
                        <td>{{ customer.is_active ? 'Yes' : 'No' }}</td>
                        <td>{{ formatDate(customer.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="ordersIn.length > 0">
            <h3>üì¶ Sample Incoming Orders</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Order #</th>
                        <th>Supplier ID</th>
                        <th>Site ID</th>
                        <th>Status ID</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="order in ordersIn.slice(0, 3)" :key="order.id">
                        <td>{{ order.id }}</td>
                        <td>{{ order.ordernr }}</td>
                        <td>{{ order.supplier_id }}</td>
                        <td>{{ order.site_id }}</td>
                        <td>{{ order.status_id }}</td>
                        <td>{{ formatDate(order.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Console Log -->
        <div class="section">
            <h3>üìù Console Log</h3>
            <div class="log">
                <div v-for="(log, index) in consoleLogs" :key="index">{{ log }}</div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loading: true,
                    error: null,
                    customers: [],
                    suppliers: [],
                    products: [],
                    ordersIn: [],
                    ordersOut: [],
                    sites: [],
                    statuses: [],
                    apiTests: [
                        { name: 'Customers API', status: 'pending', message: 'Testing...' },
                        { name: 'Suppliers API', status: 'pending', message: 'Testing...' },
                        { name: 'Products API', status: 'pending', message: 'Testing...' },
                        { name: 'Orders In API', status: 'pending', message: 'Testing...' },
                        { name: 'Orders Out API', status: 'pending', message: 'Testing...' },
                        { name: 'Sites API', status: 'pending', message: 'Testing...' },
                        { name: 'Status API', status: 'pending', message: 'Testing...' }
                    ],
                    consoleLogs: []
                }
            },
            async mounted() {
                this.log('Starting ERP Inventory Database Connection Test...');
                await this.runTests();
            },
            methods: {
                log(message) {
                    const timestamp = new Date().toLocaleTimeString();
                    this.consoleLogs.push(`[${timestamp}] ${message}`);
                    console.log(`[ERP Test] ${message}`);
                },
                async runTests() {
                    try {
                        this.loading = true;
                        this.error = null;

                        this.log('Testing API endpoints...');

                        // Test each API endpoint
                        const tests = [
                            { name: 'customers', key: 'customers' },
                            { name: 'suppliers', key: 'suppliers' },
                            { name: 'products', key: 'products' },
                            { name: 'orders-in', key: 'ordersIn' },
                            { name: 'orders-out', key: 'ordersOut' },
                            { name: 'sites', key: 'sites' },
                            { name: 'status', key: 'statuses' }
                        ];

                        for (const test of tests) {
                            try {
                                this.log(`Testing ${test.name} endpoint...`);
                                const response = await axios.get(`/${test.name}`);
                                this[test.key] = response.data;
                                
                                const testIndex = this.apiTests.findIndex(t => t.name.toLowerCase().includes(test.name.split('-')[0]));
                                if (testIndex !== -1) {
                                    this.apiTests[testIndex].status = 'success';
                                    this.apiTests[testIndex].message = `‚úÖ ${response.data.length} records loaded`;
                                }
                                
                                this.log(`‚úÖ ${test.name}: ${response.data.length} records loaded`);
                            } catch (err) {
                                this.log(`‚ùå ${test.name}: ${err.message}`);
                                const testIndex = this.apiTests.findIndex(t => t.name.toLowerCase().includes(test.name.split('-')[0]));
                                if (testIndex !== -1) {
                                    this.apiTests[testIndex].status = 'error';
                                    this.apiTests[testIndex].message = `‚ùå ${err.message}`;
                                }
                            }
                        }

                        this.log('All tests completed!');
                        this.log(`Total data loaded: ${this.customers.length + this.suppliers.length + this.products.length + this.ordersIn.length + this.ordersOut.length + this.sites.length + this.statuses.length} records`);

                    } catch (err) {
                        this.log(`‚ùå Test failed: ${err.message}`);
                        this.error = err.message;
                    } finally {
                        this.loading = false;
                    }
                },
                formatDate(date) {
                    if (!date) return 'N/A';
                    try {
                        const dateObj = new Date(date);
                        if (isNaN(dateObj.getTime())) return 'N/A';
                        return dateObj.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (error) {
                        return 'N/A';
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
