<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Inventory Database Test</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .section { margin: 20px 0; }
        .section h3 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    </style>
</head>
<body>
    <div id="app" class="container">
        <h1>ERP Inventory Database Connection Test</h1>
        
        <div v-if="loading" class="status loading">
            <strong>Loading...</strong> Fetching data from ERP database...
        </div>
        
        <div v-if="error" class="status error">
            <strong>Error:</strong> {{ error }}
        </div>
        
        <div v-if="!loading && !error" class="status success">
            <strong>âœ… Success!</strong> Database connection is working. Data loaded successfully.
        </div>

        <div class="section" v-if="customers.length > 0">
            <h3>Customers ({{ customers.length }})</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Identifier</th>
                        <th>Active</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="customer in customers.slice(0, 5)" :key="customer.id">
                        <td>{{ customer.id }}</td>
                        <td>{{ customer.name }}</td>
                        <td>{{ customer.identifier }}</td>
                        <td>{{ customer.is_active ? 'Yes' : 'No' }}</td>
                        <td>{{ formatDate(customer.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="suppliers.length > 0">
            <h3>Suppliers ({{ suppliers.length }})</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Identifier</th>
                        <th>Active</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="supplier in suppliers.slice(0, 5)" :key="supplier.id">
                        <td>{{ supplier.id }}</td>
                        <td>{{ supplier.name }}</td>
                        <td>{{ supplier.identifier }}</td>
                        <td>{{ supplier.is_active ? 'Yes' : 'No' }}</td>
                        <td>{{ formatDate(supplier.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="ordersIn.length > 0">
            <h3>Incoming Orders ({{ ordersIn.length }})</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Order #</th>
                        <th>Supplier ID</th>
                        <th>Site ID</th>
                        <th>Status ID</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="order in ordersIn.slice(0, 5)" :key="order.id">
                        <td>{{ order.id }}</td>
                        <td>{{ order.ordernr }}</td>
                        <td>{{ order.supplier_id }}</td>
                        <td>{{ order.site_id }}</td>
                        <td>{{ order.status_id }}</td>
                        <td>{{ formatDate(order.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="ordersOut.length > 0">
            <h3>Outgoing Orders ({{ ordersOut.length }})</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Order #</th>
                        <th>Customer ID</th>
                        <th>Site ID</th>
                        <th>Status ID</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="order in ordersOut.slice(0, 5)" :key="order.id">
                        <td>{{ order.id }}</td>
                        <td>{{ order.ordernr }}</td>
                        <td>{{ order.customer_id }}</td>
                        <td>{{ order.site_id }}</td>
                        <td>{{ order.status_id }}</td>
                        <td>{{ formatDate(order.created_at) }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" v-if="products.length > 0">
            <h3>Products ({{ products.length }})</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Code</th>
                        <th>Unit ID</th>
                        <th>Type ID</th>
                        <th>Status ID</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="product in products.slice(0, 5)" :key="product.id">
                        <td>{{ product.id }}</td>
                        <td>{{ product.name }}</td>
                        <td>{{ product.code }}</td>
                        <td>{{ product.unit_id }}</td>
                        <td>{{ product.product_type_id }}</td>
                        <td>{{ product.status_id }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    loading: true,
                    error: null,
                    customers: [],
                    suppliers: [],
                    products: [],
                    ordersIn: [],
                    ordersOut: [],
                    sites: [],
                    statuses: []
                }
            },
            async mounted() {
                await this.loadData();
            },
            methods: {
                async loadData() {
                    try {
                        this.loading = true;
                        this.error = null;

                        const [
                            customersRes,
                            suppliersRes,
                            productsRes,
                            ordersInRes,
                            ordersOutRes,
                            sitesRes,
                            statusRes
                        ] = await Promise.all([
                            axios.get('/customers'),
                            axios.get('/suppliers'),
                            axios.get('/products'),
                            axios.get('/orders-in'),
                            axios.get('/orders-out'),
                            axios.get('/sites'),
                            axios.get('/status')
                        ]);

                        this.customers = customersRes.data;
                        this.suppliers = suppliersRes.data;
                        this.products = productsRes.data;
                        this.ordersIn = ordersInRes.data;
                        this.ordersOut = ordersOutRes.data;
                        this.sites = sitesRes.data;
                        this.statuses = statusRes.data;

                        console.log('Data loaded successfully:', {
                            customers: this.customers.length,
                            suppliers: this.suppliers.length,
                            products: this.products.length,
                            ordersIn: this.ordersIn.length,
                            ordersOut: this.ordersOut.length,
                            sites: this.sites.length,
                            statuses: this.statuses.length
                        });

                    } catch (err) {
                        console.error('Error loading data:', err);
                        this.error = err.message;
                    } finally {
                        this.loading = false;
                    }
                },
                formatDate(date) {
                    if (!date) return 'N/A';
                    try {
                        const dateObj = new Date(date);
                        if (isNaN(dateObj.getTime())) return 'N/A';
                        return dateObj.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    } catch (error) {
                        return 'N/A';
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
